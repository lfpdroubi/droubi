[
  {
    "path": "posts/2021-02-13-retransformao-de-variveis-raiz-cbica/",
    "title": "Retransformação de Variáveis - raiz cúbica",
    "description": "Parte 3.",
    "author": [
      {
        "name": "Nora Jones",
        "url": "https://example.com/norajones"
      }
    ],
    "date": "2024-02-15",
    "categories": [],
    "contents": "\r\nSegundo Land (1972),\r\no cubo de uma variável aleatória normal \\(X \\sim N(\\mu, \\sigma^2)\\) é igual a (ver prova):\r\n\\[\\mathbb{E}[X^3] = \\mu^3 + 3\\mu\\sigma^2\\]\r\nPara melhor compreender, criei os dados abaixo no R:\r\n\r\n\r\nset.seed(1)\r\ndados <- data.frame(\r\n  Area = runif(100, min = 360, max = 600)\r\n)\r\ndados$CROOTVU <- 40 - .05*dados$Area + rnorm(100, mean = 0, sd = 1.5)\r\ndados$VU <- dados$CROOTVU^3\r\n\r\n\r\nA Figura 1 mostra que os dados transformados pela raiz cúbica são\r\naproximadamente normais.\r\n\r\n\r\nm <- mean(dados$VU^(1/3))\r\ns <- sd(dados$VU^(1/3))\r\nhistogram(~VU^(1/3), dados)\r\nplotDist(\"norm\", mean = m, sd = s, add = TRUE)\r\n\r\n\r\n\r\nFigure 1: Histograma dos dados transformados.\r\n\r\n\r\n\r\nPrimeiro ajustamos um modelo linear:\r\n\r\n\r\nlinFit <- lm(VU~Area, dados)\r\nsummary(linFit)\r\n\r\n\r\nCall:\r\nlm(formula = VU ~ Area, data = dados)\r\n\r\nResiduals:\r\n    Min      1Q  Median      3Q     Max \r\n-2665.4  -736.0  -124.3   501.4  5114.1 \r\n\r\nCoefficients:\r\n             Estimate Std. Error t value Pr(>|t|)    \r\n(Intercept) 22608.881   1004.015   22.52   <2e-16 ***\r\nArea          -37.484      2.055  -18.24   <2e-16 ***\r\n---\r\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\r\n\r\nResidual standard error: 1313 on 98 degrees of freedom\r\nMultiple R-squared:  0.7724,    Adjusted R-squared:  0.7701 \r\nF-statistic: 332.6 on 1 and 98 DF,  p-value: < 2.2e-16\r\n\r\nPercebem-se os problemas do modelo na Figura 2:\r\n\r\n\r\n\r\nFigure 2: Modelo linear.\r\n\r\n\r\n\r\nA Figura ?? mostra que a transformação ideal é mesmo a raiz\r\ncúbica (que surpresa!).\r\n\r\n\r\nboxcox(linFit)\r\n\r\n\r\n\r\nMais uma vez, fica nítida a não-linearidade pela análise da Figura\r\n3, como no caso da raiz quadrada. Mas é claro que o ajuste\r\nestá longe do ideal.\r\n\r\n\r\npowerPlot(linFit, axis = \"inverted\")\r\n\r\n\r\n\r\nFigure 3: Poder de Predição para o modelo linear.\r\n\r\n\r\n\r\nAjusta-se então um modelo com a variável transformada.\r\n\r\n\r\ntransFit <- lm(VU^(1/3)~Area, dados)\r\ns <- summary(transFit)\r\ns\r\n\r\n\r\nCall:\r\nlm(formula = VU^(1/3) ~ Area, data = dados)\r\n\r\nResiduals:\r\n    Min      1Q  Median      3Q     Max \r\n-2.7747 -0.8433 -0.1306  0.7864  3.7749 \r\n\r\nCoefficients:\r\n             Estimate Std. Error t value Pr(>|t|)    \r\n(Intercept) 39.028240   1.079110   36.17   <2e-16 ***\r\nArea        -0.048048   0.002209  -21.75   <2e-16 ***\r\n---\r\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\r\n\r\nResidual standard error: 1.412 on 98 degrees of freedom\r\nMultiple R-squared:  0.8284,    Adjusted R-squared:  0.8266 \r\nF-statistic: 473.1 on 1 and 98 DF,  p-value: < 2.2e-16\r\n\r\nNa Figura 4 pode-se ver o Poder de Predição do modelo com a\r\nretransformação naive, ou seja, com a adoção da mediana.\r\n\r\n\r\npowerPlot(dados$VU, fitted(transFit)^3, axis = \"inverted\")\r\n\r\n\r\n\r\nFigure 4: Poder de predição com retransformação\r\n\r\n\r\n\r\nE na Figura 5 pode-se ver o Poder de Predição obtido com a média\r\nda distribuição original.\r\n\r\n\r\nyhatMedia <- fitted(transFit)^3 + 3*fitted(transFit)*s$sigma^2\r\npowerPlot(dados$VU, yhatMedia, axis = \"inverted\")\r\n\r\n\r\n\r\nFigure 5: Poder de predição com a média.\r\n\r\n\r\n\r\nÉ possível perceber que o ajuste dos dados (\\(R^2\\)) não aumenta substancialmente.\r\nDe maneira análoga, aliás, ao que ocorreu com as outras transformações estudadas\r\nnos posts anteriores.\r\nMas percebe-se uma nítida melhora na previsão de valores nos extremos da\r\namostra. Além disto, as hipóteses da inferência clássica não se verificam nos\r\nmodelos sem a transformação das variáveis, o que significa que os testes de\r\nhipótese e os intervalos de confiança obtidos com estes modelos.\r\n\r\n\r\n\r\n",
    "preview": "posts/2021-02-13-retransformao-de-variveis-raiz-cbica/retransformao-de-variveis-raiz-cbica_files/figure-html5/hist-1.png",
    "last_modified": "2024-02-15T12:42:42-03:00",
    "input_file": {}
  },
  {
    "path": "posts/2021-01-12-retransformao-de-variveis/",
    "title": "Retransformação de Variáveis",
    "description": "Parte 2.",
    "author": [
      {
        "name": "Luiz Droubi",
        "url": "https://lfpdroubi.github.io/droubi/"
      }
    ],
    "date": "2021-01-12",
    "categories": [],
    "contents": "\r\nEm um dos posts anteriores comentei brevemente sobre\r\no problema da retransformação de variáveis. No\r\núltimo post\r\nmostrei algumas simulações sobre a retransformação de valores quando utiliza-se\r\na transformação da variável dependente para a escala logarítmica.\r\nNeste post, vou mostrar algumas simulações que fiz sobre o problema da\r\nretransformação quando utiliza-se a função raiz quadrada para a transformação da\r\nvariável dependente.\r\nSegundo Land (1972),\r\nquando esta transformação é aplicada a retransformação deve ser feita com a\r\nseguinte expressão (ver prova):\r\n\\[Y = \\sqrt{X}; \\mathbb{E}[X] = \\mu^2 + \\sigma^2\\]\r\nVamos ver, então, como fica a previsão de valores com um modelo ajustado com\r\neste tipo de dados.\r\nOs dados foram criados, no R, com o código abaixo:\r\n\r\n\r\nset.seed(1)\r\ndados <- data.frame(\r\n  Area = runif(100, min = 360, max = 600)\r\n)\r\ndados$SQRTVU <- 250 - .4*dados$Area + rnorm(100, mean = 0, sd = 12.5)\r\ndados$VU <- dados$SQRTVU^2\r\n\r\n\r\nPode-se demonstrar que, se \\(\\sqrt{VU} \\sim N(\\mu, \\sigma^2)\\), então \\(VU\\) tem\r\ndistribuição \\(\\chi^2\\)\r\ngeneralizada,\r\ncom 2 graus 1 grau de liberdade, parâmetro de não-centralidade \\(\\lambda = (\\mu/\\sigma)^2\\), o que pode ser verificado com o código abaixo:\r\n\r\n\r\nlibrary(mosaic)\r\nm <- mean(dados$SQRTVU)\r\ns <- sd(dados$SQRTVU)\r\nhistogram(sqrt(s^2*rchisq(300, 1, ncp = (m/s)^2)))\r\nplotDist(\"norm\", mean = m, sd = s, add = TRUE)\r\n\r\n\r\n\r\nNa prática, então, de posse de uma amostra, podemos testar:\r\nSe a raiz quadrada dos dados se ajusta à distribuição normal, como acima;\r\nSe os dados se ajustam a uma distribuição \\(\\chi^2\\) generalizada, como\r\nilustrado abaixo:\r\n\r\n\r\nhistogram(~VU/s^2, dados)\r\nplotDist(\"chisq\", df = 1, ncp = (m/s)^2, add = TRUE)\r\n\r\n\r\n\r\n\r\n\r\n\r\nÉ boa prática utilizar a família de Box-Cox para verificar o melhor parâmetro\r\npara a transformação dos dados. Para isto, no R, podemos ajustar primeiro um\r\nmodelo linear (sem transformacões):\r\n\r\n\r\nlinFit <- lm(VU~Area, dados)\r\nsummary(linFit)\r\n\r\n\r\nCall:\r\nlm(formula = VU ~ Area, data = dados)\r\n\r\nResiduals:\r\n    Min      1Q  Median      3Q     Max \r\n-3316.2  -915.6  -204.2   663.1  6354.5 \r\n\r\nCoefficients:\r\n             Estimate Std. Error t value Pr(>|t|)    \r\n(Intercept) 25092.353   1240.384   20.23   <2e-16 ***\r\nArea          -43.801      2.539  -17.25   <2e-16 ***\r\n---\r\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\r\n\r\nResidual standard error: 1623 on 98 degrees of freedom\r\nMultiple R-squared:  0.7522,    Adjusted R-squared:  0.7497 \r\nF-statistic: 297.5 on 1 and 98 DF,  p-value: < 2.2e-16\r\n\r\nPercebe-se na Figura 1 a presença de alguma não-linearidade no\r\nmodelo.\r\n\r\n\r\n\r\nFigure 1: Modelo linear.\r\n\r\n\r\n\r\nE na Figura 2, o Poder de Predição do modelo linear.\r\nPercebe-se que o problema fica na estimação de valores nos extremos da escala\r\n(inclusive o modelo prevê alguns valores negativos).\r\n\r\n\r\n\r\n\r\n\r\npowerPlot(linFit, axis = \"inverted\")\r\n\r\n\r\n\r\nFigure 2: Poder de Predição para o modelo linear.\r\n\r\n\r\n\r\nA Figura 3 mostra que o melhor parâmetro para transformação\r\né, aproximadamente, 0.5. Ou seja, a transformação mais conveniente é a raiz\r\nquadrada.\r\n\r\n\r\nboxCox(linFit)\r\n\r\n\r\n\r\nFigure 3: Ajuste do parâmetro de transformação para família de Box-Cox.\r\n\r\n\r\n\r\nAjusta-se o modelo, então, com a transformação adequada:\r\n\r\n\r\ntransFit <- lm(sqrt(VU)~Area, dados)\r\ns <- summary(transFit)\r\ns\r\n\r\n\r\nCall:\r\nlm(formula = sqrt(VU) ~ Area, data = dados)\r\n\r\nResiduals:\r\n    Min      1Q  Median      3Q     Max \r\n-23.122  -7.028  -1.088   6.553  31.458 \r\n\r\nCoefficients:\r\n             Estimate Std. Error t value Pr(>|t|)    \r\n(Intercept) 241.90200    8.99258   26.90   <2e-16 ***\r\nArea         -0.38373    0.01841  -20.84   <2e-16 ***\r\n---\r\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\r\n\r\nResidual standard error: 11.76 on 98 degrees of freedom\r\nMultiple R-squared:  0.816, Adjusted R-squared:  0.8141 \r\nF-statistic: 434.5 on 1 and 98 DF,  p-value: < 2.2e-16\r\n\r\nE verifica-se o poder de predição.\r\nPrimeiro com a simples retransformação pela função inversa (naive), que\r\nleva à mediana da distribuição. Percebe-se que, devido à transformação, não são\r\nprevistos mais quaisquer valores negativos, o que é desejável.\r\n\r\n\r\npowerPlot(transFit, axis = \"inverted\", func = \"sqrt\")\r\n\r\n\r\n\r\nFigure 4: Poder de predição com retransformação\r\n\r\n\r\n\r\nDepois com o valor esperado (ou média) da distribuição:\r\n\r\n\r\nyhatMedia <- fitted(transFit)^2 + s$sigma^2\r\npowerPlot(dados$VU, yhatMedia, axis = \"inverted\")\r\n\r\n\r\n\r\nFigure 5: Poder de predição com a média.\r\n\r\n\r\n\r\nMais uma vez: a estimação foi realizada com a minimização da função erro médio\r\nquadrático (MSE), já que foi utilizada a regressão linear. Mas não\r\nnecessariamente deve ser utilizada a média para a previsão de valores.\r\nNa regressão à mediana o problema da retransformação desaparece: o quantil da\r\nvariável transformada corresponde ao mesmo quantil da variável original, já que\r\na transformação foi feita com uma função monótona (ver Koenker e Basset (1978, p.39-40)).\r\nDesta forma, pode-se aplicar a regressão quantílica e depois simplesmente\r\nretransformar os valores previstos com a função inversa, obtendo-se o mesmo\r\nquantil estimado.\r\n(A regressão quantílica não pressupõe normalidade, porém a transformação\r\npossibilita a previsão de valores sempre positivos).\r\n\r\n\r\nlibrary(quantreg)\r\nmedFit <- rq(sqrt(VU)~Area, dados, tau = .5)\r\npowerPlot(medFit, axis = \"inverted\", func = \"sqrt\")\r\n\r\n\r\nNULL\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/2021-01-12-retransformao-de-variveis/retransformao-de-variveis_files/figure-html5/unnamed-chunk-2-1.png",
    "last_modified": "2024-02-15T15:17:05-03:00",
    "input_file": "retransformao-de-variveis.knit.md"
  },
  {
    "path": "posts/2020-12-30-implicaes-da-utilizao-de-transformaes-sobre-a-varivel-dependente/",
    "title": "Implicações da utilização de transformações sobre a variável dependente",
    "description": "Sobre retransformação de variáveis.",
    "author": [
      {
        "name": "Luiz Droubi",
        "url": "https://lfpdroubi.github.io/droubi/"
      }
    ],
    "date": "2020-12-30",
    "categories": [],
    "contents": "\r\nÉ muito comum na Engenharia de Avaliações a aplicação de transformações à\r\nvariável dependente para a confecção do modelo de regressão linear.\r\nAs consequências da adoção de transformações sobre a variável dependente,\r\ncontudo ainda não foram bem esclarecidas aos avaliadores.\r\nEm 2018, elaboramos um artigo para o COBRAC,\r\nassim como um artigo para o VIII Simpósio da SOBREA em que analisamos as\r\nconsequências da transformação da variável dependente para a distribuição\r\nlognormal. Naquela ocasião, contudo, além de nos atermos apenas a essa\r\ntransformação, focamos apenas na questão do valor da estimativa central e não\r\nnos aprofundamos na questão dos intervalos de confiança.\r\nAlguns dias atrás, contudo, enquanto fazia uma pequena pesquisa sobre intervalos\r\nde confiança, cheguei ao artigo original de Land (1972), onde\r\neste descreve um procedimento para obtenção de intervalos de confiança exatos\r\npara a média da distribuição lognormal, além de um procedimento para a obtenção\r\nde intervalos aproximados para outras transformações não-lineares da variável\r\ndependente.\r\nEm relação ao valor esperado, eis o que acontece, para diversas transformações\r\nusuais:\r\n\\(Y = \\ln(X); \\mathbb{E}[X] = \\exp(\\mu + \\frac{1}{2}\\sigma^2)\\)\r\n\\(Y = \\sqrt{X}; \\mathbb{E}[X] = \\mu^2 + \\sigma^2\\)\r\n\\(Y = \\sqrt[3]{X}; \\mathbb{E}[X] = \\mu^3 + 3\\mu\\sigma^2\\)\r\nDeve-se perceber o seguinte: se o valor de \\(\\sigma\\) for baixo, a simplificação\r\nusual que fazemos, de simplesmente aplicar a transformação inversa, pode ser\r\ntranquilamente aceita. Porém, se o valor de \\(\\sigma^2\\) não puder ser desprezado,\r\no valor obtido com a simples retransformação pode ficar resultar bem viesado.\r\nQuanto aos intervalos, é usual que apliquemos também a simples retransformação\r\naos seus limites superior e inferior, que são os limites dos denominados naive\r\nintervals. Por exemplo, se optamos pela avaliação com a média, aplicamos a\r\nretransformação \\(\\exp(VU + \\sigma^2/2)\\) tanto para o valor central como para os\r\nlimites do intervalo obtido com o modelo com a variável transformada. Este\r\nmétodo de obtenção do intervalo, a partir da retransformação do intervalo obtido\r\ncom a variável normalizada, é denominado método da aproximação normal.\r\nVamos ver como um intervalo para a média calculado com este método se distancia\r\ndo intervalo exato, ou seja, do intervalo calculado segundo o método de Land.\r\nPara isto, vou utilizar os dados de valores de apartamentos no centro de\r\nFlorianópolis em 2015, obtidos pelo Prof. Norberto Hochheim, meu orientador.\r\nComo é possível ver na Figura 1, claramente se trata de dados\r\ncom distribuição lognormal.\r\n\r\n\r\n\r\n\r\n\r\n\r\nFigure 1: Ajuste de uma distribuição lognormal aos dados.\r\n\r\n\r\n\r\n\r\nFitting of the distribution ' lnorm ' by maximum likelihood \r\nParameters : \r\n          estimate Std. Error\r\nmeanlog 13.5792960 0.08710166\r\nsdlog    0.6159017 0.06158944\r\nLoglikelihood:  -725.6783   AIC:  1455.357   BIC:  1459.181 \r\nCorrelation matrix:\r\n        meanlog sdlog\r\nmeanlog       1     0\r\nsdlog         0     1\r\n\r\nAgora vamos efetuar o cálculo do intervalo de confiança para a média estimada\r\ndos valores da distribuição. Primeiramente, utilizando o método de Land\r\n(intervalo exato):\r\n\r\n\r\nlibrary(EnvStats)\r\nelnormAlt(dados$valor, ci = TRUE, ci.method = \"land\")\r\n\r\n\r\nResults of Distribution Parameter Estimation\r\n--------------------------------------------\r\n\r\nAssumed Distribution:            Lognormal\r\n\r\nEstimated Parameter(s):          mean = 9.538529e+05\r\n                                 cv   = 6.756391e-01\r\n\r\nEstimation Method:               mvue\r\n\r\nData:                            dados$valor\r\n\r\nSample Size:                     50\r\n\r\nConfidence Interval for:         mean\r\n\r\nConfidence Interval Method:      Land\r\n\r\nConfidence Interval Type:        two-sided\r\n\r\nConfidence Level:                95%\r\n\r\nConfidence Interval:             LCL =  802218.8\r\n                                 UCL = 1185112.0\r\n\r\nE agora com o método da aproximação normal:\r\n\r\n\r\nelnormAlt(dados$valor, ci = TRUE, ci.method = \"normal.approx\")\r\n\r\n\r\nResults of Distribution Parameter Estimation\r\n--------------------------------------------\r\n\r\nAssumed Distribution:            Lognormal\r\n\r\nEstimated Parameter(s):          mean = 9.538529e+05\r\n                                 cv   = 6.756391e-01\r\n\r\nEstimation Method:               mvue\r\n\r\nData:                            dados$valor\r\n\r\nSample Size:                     50\r\n\r\nConfidence Interval for:         mean\r\n\r\nConfidence Interval Method:      Normal Approximation\r\n                                 (t Distribution)\r\n\r\nConfidence Interval Type:        two-sided\r\n\r\nConfidence Level:                95%\r\n\r\nConfidence Interval:             LCL =  772391.8\r\n                                 UCL = 1135313.9\r\n\r\nNota-se que a diferença entre os limites inferior (LCL) e superior (UCL) dos\r\nintervalos aproximados calculados diferem menos de 5% (a menor) dos valores\r\nexatos.\r\nPode-se argumentar que esta aproximação é tolerável, porém deve-se lembrar que a\r\nNBR 14.653-2 permite arredondamentos até 1% do valor final, de maneira que seria\r\nsubjetivo um avaliador determinar o quanto seria aceitável, estando esta\r\ndiferença acima do valor recomendado pela norma.\r\nPor fim, é bom esclarecer que os intervalos obtidos com a variável normalizada\r\nsão exatos para a estimação da mediana da distribuição lognormal. Talvez seja\r\no caso de, numa próxima revisão da NBR 14.653 estabelecer que a mediana deva\r\nser utilizada em lugar da média (ou da moda) para a estimava de valores, já que,\r\ndesta maneira, simplifica-se sobremaneira o problema.\r\nFeliz ano novo a todos!\r\n\r\n\r\n\r\n",
    "preview": "posts/2020-12-30-implicaes-da-utilizao-de-transformaes-sobre-a-varivel-dependente/implicaes-da-utilizao-de-transformaes-sobre-a-varivel-dependente_files/figure-html5/dists-1.png",
    "last_modified": "2024-02-15T15:11:20-03:00",
    "input_file": "implicaes-da-utilizao-de-transformaes-sobre-a-varivel-dependente.knit.md"
  }
]
